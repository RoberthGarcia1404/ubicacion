<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Cultivos - Papa y Cebolla</title>
    <link rel="stylesheet" href="styles.css">
    <!-- ‚úÖ Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>


<body>
    <div class="container">
        <header>
            <h1>üå± Asistente de Cultivos</h1>
            <p class="subtitle">Obt√©n recomendaciones de suelo para papa y cebolla</p>
        </header>
<div id="info-ubicacion" class="location-info oculto">
    <div class="location-icon">üìç</div>
    <div class="location-details">
        <p><strong>Ubicaci√≥n detectada:</strong></p>
        <div class="coordinates" id="coordenadas">Cargando...</div>
        <p class="accuracy" id="precision">Precisi√≥n: calculando...</p>
        <div class="gps-status" id="gps-status">
            <span class="indicador-estado" id="indicador-estado"></span>
            <span id="texto-estado">Evaluando precisi√≥n del GPS...</span>
        </div>
    </div>
</div>

<!-- ‚úÖ Aqu√≠ se muestra el mapa -->
<div id="map" style="height:300px; margin-top:15px; border-radius:8px;" class="oculto"></div>



        <div class="content">
            <button id="btn-ubicacion">üìç Obtener mi ubicaci√≥n autom√°ticamente</button>
            <div id="caja-error" class="error-box oculto">
                <strong>Error:</strong> <span id="mensaje-error"></span>
                <button class="retry-btn" id="btn-reintentar">Reintentar</button>
            </div>
            <div id="info-ubicacion" class="location-info oculto">
                <div class="location-icon">üìç</div>
                <div class="location-details">
                    <p><strong>Ubicaci√≥n detectada:</strong></p>
                    <div class="coordinates" id="coordenadas">Cargando...</div>
                    <p class="accuracy" id="precision">Precisi√≥n: calculando...</p>
                    <div class="gps-status" id="gps-status">
                        <span class="indicador-estado" id="indicador-estado"></span>
                        <span id="texto-estado">Evaluando precisi√≥n del GPS...</span>
                    </div>
                </div>
            </div>
            <div id="cargando" class="loading oculto">
                <div class="loading-spinner"></div>
                <p>üîç Obteniendo datos del suelo desde ISRIC SoilGrids...</p>
                <p>Esto puede tomar unos segundos</p>
            </div>
            <div id="resultados" class="results oculto">
                <h2>üìä An√°lisis de Suelo y Recomendaciones</h2>
                <div id="datos-suelo" class="soil-data">
                    <!-- Los datos reales del suelo se insertar√°n aqu√≠ -->
                </div>
                <div class="crop-card">
                    <h3 class="crop-title"><span>ü•î</span> Cultivo de Papa</h3>
                    <div class="soil-property">
                        <span class="property-name">pH ideal:</span> 5.5 - 6.5
                    </div>
                    <div class="soil-property">
                        <span class="property-name">Textura ideal:</span> Franco-arenosa
                    </div>
                    <div class="soil-property">
                        <span class="property-name">Materia org√°nica:</span> Alta (3-4%)
                    </div>
                    <div class="soil-property">
                        <span class="property-name">Drenaje:</span> Bueno, evitar encharcamientos
                    </div>
                    <div class="recommendation">
                        üí° <strong>Tip:</strong> Para mejorar el rendimiento, aseg√∫rate de un buen drenaje y rotaci√≥n de cultivos. La papa es sensible al pH muy alto.
                    </div>
                </div>
                <div class="crop-card">
                    <h3 class="crop-title"><span>üßÖ</span> Cultivo de Cebolla</h3>
                    <div class="soil-property">
                        <span class="property-name">pH ideal:</span> 6.0 - 7.0
                    </div>
                    <div class="soil-property">
                        <span class="property-name">Textura ideal:</span> Franco-arcillosa
                    </div>
                    <div class="soil-property">
                        <span class="property-name">Materia org√°nica:</span> Media (2-3%)
                    </div>
                    <div class="soil-property">
                        <span class="property-name">Drenaje:</span> Bueno, suelos bien estructurados
                    </div>
                    <div class="recommendation">
                        üí° <strong>Tip:</strong> La cebolla prefiere suelos bien drenados con buena exposici√≥n solar. Tolera mejor los suelos ligeramente alcalinos que la papa.
                    </div>
                </div>
                <div id="analisis-compatibilidad" class="compatibility-analysis">
                    <h3 style="color: #007bff;">üî¨ An√°lisis de Compatibilidad del Suelo</h3>
                    <div id="contenido-compatibilidad">
                        <!-- El an√°lisis de compatibilidad se insertar√° aqu√≠ -->
                    </div>
                </div>
                <button class="improve-btn" id="btn-mejorar">üîÑ Mejorar precisi√≥n de ubicaci√≥n</button>
            </div>
        </div>
        <footer>
            <p>üåæ Usa esta herramienta para planificar tus cultivos de papa y cebolla</p>
            <p>¬© 2023 - Asistente Agr√≠cola | Datos de suelo: ISRIC SoilGrids</p>
        </footer>
    </div>


    <script src="app.js"></script>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Crear el mapa
    const map = L.map('map').setView([0, 0], 15);

    // Agregar capa de mapa (tiles de OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>'
    }).addTo(map);

    // Marcador para la ubicaci√≥n
    let marker;

    // Opciones de geolocalizaci√≥n para m√°s precisi√≥n
    const options = {
      enableHighAccuracy: true, // GPS en lugar de WiFi
      timeout: 10000, // esperar m√°ximo 10 seg
      maximumAge: 0 // no usar cache
    };

    // Funci√≥n de √©xito
    function success(pos) {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const accuracy = pos.coords.accuracy; // en metros

      // Centrar el mapa
      map.setView([lat, lon], 18);

      // Si no existe el marcador lo crea, si existe lo actualiza
      if (!marker) {
        marker = L.marker([lat, lon]).addTo(map)
          .bindPopup(`üìç Est√°s aqu√≠<br>Precisi√≥n: ${accuracy.toFixed(1)} m`)
          .openPopup();
      } else {
        marker.setLatLng([lat, lon])
          .setPopupContent(`üìç Est√°s aqu√≠<br>Precisi√≥n: ${accuracy.toFixed(1)} m`);
      }
    }

    // Funci√≥n de error
    function error(err) {
      console.error(`ERROR(${err.code}): ${err.message}`);
      alert("No se pudo obtener tu ubicaci√≥n. Revisa permisos del GPS.");
    }

    // Seguir en tiempo real la ubicaci√≥n
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(success, error, options);
    } else {
      alert("Tu navegador no soporta geolocalizaci√≥n.");
    }
  </script>
</body>
</html>






